
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Spring Boot demo系列（五）：Docker部署 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615371949211">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615371949211" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/spring-boot-demo-xi-lie-wu-docker-bu-shu.jpg')">
            </div>
          
          <h2 class="post-title">Spring Boot demo系列（五）：Docker部署</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-09-15</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/4z8YfVN_z/">
                    Docker
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/HhAuEu6wC/">
                    Demo
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/jLOEqgo2m/">
                    Spring Boot
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h1 id="2021224-更新">2021.2.24 更新</h1>
<h1 id="1-概述">1 概述</h1>
<p>本文讲述了如何使用<code>Docker</code>部署<code>Spring Boot</code>应用，首先介绍了<code>Docker</code>的安装过程，接着介绍了<code>Docker</code>的一些基础知识，最后讲述了<code>Dockerfile</code>的编写以及部署过程。</p>
<h1 id="2-环境">2 环境</h1>
<ul>
<li>服务器：<code>aarch64 CentOS8</code></li>
<li><code>JDK</code>：<code>OpenJDK 11</code></li>
<li><code>Docker</code>：<code>19.03.9</code></li>
</ul>
<h1 id="3-docker安装">3 <code>Docker</code>安装</h1>
<p>（已安装了<code>Docker</code>可以跳过该部分）</p>
<p>由于大部分的教程都是针对<code>x86</code>架构的服务器的，这里笔者的服务器为<code>aarch64</code>架构，因此记录一下<code>Docker</code>的安装过程。</p>
<p><code>Docker</code>安装方法主要有两种，一种是通过官网的脚本自动安装，一种是通过<code>yum</code>手动安装。</p>
<h2 id="31-自动安装">3.1 自动安装</h2>
<pre><code class="language-bash">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
</code></pre>
<p>或</p>
<pre><code class="language-bash">curl -sSL https://get.daocloud.io/docker | sh
</code></pre>
<p>默认安装的是最新版本的，<code>x86</code>的一般都可以，但如果出现像笔者这样的错误：</p>
<figure data-type="image" tabindex="1"><img src="https://img-blog.csdnimg.cn/20200914123420327.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>表明<code>containerd.io</code>的版本过低，使用<code>yum install containerd.io</code>安装的话：</p>
<figure data-type="image" tabindex="2"><img src="https://img-blog.csdnimg.cn/20200914123504783.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>可以看到是<code>1.2.0</code>版本，并不符合安装的最低要求，解决这种问题有两个办法：</p>
<ul>
<li>手动下载<code>rpm</code>包安装</li>
<li>安装没那么新版本的<code>Docker</code></li>
</ul>
<p>因此采用手动安装的方法，这里选择的是第一种方法，手动下载<code>rpm</code>包进行安装。</p>
<h2 id="32-手动安装">3.2 手动安装</h2>
<h3 id="321-下载rpm包">3.2.1 下载<code>rpm</code>包</h3>
<p>可以<a href="https://download.docker.com/linux/centos/7/aarch64/stable/Packages/">戳这里</a>下载<code>rpm</code>包：</p>
<figure data-type="image" tabindex="3"><img src="https://img-blog.csdnimg.cn/20200914124422961.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>选择好版本即可，笔者选择的是：</p>
<ul>
<li><code>containerd.io-1.2.13-3.2.el7.aarch64.rpm</code></li>
<li><code>docker-ce-19.03.9-3.el7.aarch64.rpm</code></li>
<li><code>docker-ce-cli-19.03.9-3.el7.aarch64.rpm</code></li>
</ul>
<h3 id="322-安装">3.2.2 安装</h3>
<p>上传到服务器后，安装即可：</p>
<pre><code class="language-bash">yum install \
containerd.io-1.2.13-3.2.el7.aarch64.rpm \
docker-ce-19.03.9-3.el7.aarch64.rpm \
docker-ce-cli-19.03.9-3.el7.aarch64.rpm \
-y
</code></pre>
<h2 id="33-测试">3.3 测试</h2>
<p>先开启服务：</p>
<pre><code class="language-bash">systemctl start docker
</code></pre>
<p>版本查看：</p>
<pre><code class="language-bash">docker version
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://img-blog.csdnimg.cn/20200914125108121.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>运行<code>Hello World</code>：</p>
<pre><code>docker run hello-world
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://img-blog.csdnimg.cn/20200914125213619.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h1 id="4-打包">4 打包</h1>
<p>新建一个<code>Demo</code>工程，启动类如下：</p>
<pre><code class="language-java">@SpringBootApplication
@RestController
public class DemoApplication {

	@GetMapping(&quot;/test&quot;)
	public String test()
	{
		return &quot;success&quot;;
	}

	public static void main(String[] args) {
		SpringApplication.run(DemoApplication.class, args);
	}
}
</code></pre>
<p>接着使用<code>Maven</code>/<code>Gradle</code>打成<code>JAR</code>包：</p>
<figure data-type="image" tabindex="6"><img src="https://img-blog.csdnimg.cn/20200914125830644.png" alt="在这里插入图片描述" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://img-blog.csdnimg.cn/20200914125404461.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h1 id="5-dockerfile">5 <code>Dockerfile</code></h1>
<h2 id="51-关于dockerfile">5.1 关于<code>Dockerfile</code></h2>
<p><code>Dockerfile</code>是一个用于组合镜像的文本文件，<code>Docker</code>通过读取<code>Dockerfile</code>的内容自动生成镜像，一般分为四部分：</p>
<ul>
<li>基础镜像信息</li>
<li>维护者信息</li>
<li>镜像操作指令</li>
<li>容器启动指令</li>
</ul>
<p>更多的内容请参考其他博客或者官网，下面给出一个<code>Demo</code>。</p>
<h2 id="52-dockerfile示例">5.2 <code>Dockerfile</code>示例</h2>
<p>本<code>Demo</code>采用的<code>Dockerfile</code>如下：</p>
<pre><code class="language-bash">FROM adoptopenjdk/openjdk11:aarch64-centos-jdk-11.0.8_10

MAINTAINER XXXXX &lt;XXX@XXX.com&gt;

VOLUME /tmp

EXPOSE 8080

ADD demo.jar demo.jar

ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;]
</code></pre>
<p>下面逐行进行详细说明。</p>
<h3 id="521-指定基础镜像">5.2.1 指定基础镜像</h3>
<pre><code class="language-bash">FROM adoptopenjdk/openjdk11:aarch64-centos-jdk-11.0.8_10
</code></pre>
<p>该命令指定基础镜像，<code>adopt</code>的<code>aarch64</code>架构的<code>JDK11</code>，注意如果服务器架构为<code>x86</code>需要对应修改，具体可以戳这里查看：</p>
<figure data-type="image" tabindex="8"><img src="https://img-blog.csdnimg.cn/20200914133513320.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h3 id="522-维护者">5.2.2 维护者</h3>
<pre><code class="language-bash">MAINTAINER XXXXX &lt;XXX@XXX.com&gt;
</code></pre>
<p>该命令指定了维护者的信息，可以只写名字或者只写邮箱，组合的话需要加上<code>&lt;&gt;</code>。</p>
<h3 id="523-持久化目录">5.2.3 持久化目录</h3>
<pre><code class="language-bash">VOLUME /tmp
</code></pre>
<p>该命令指定了持久化目录，准确来说，<code>volume</code>是<code>卷</code>的意思，这是指定<code>卷</code>的位置，一般来说如果需要数据持久化则需要数据卷。</p>
<h3 id="524-暴露端口">5.2.4 暴露端口</h3>
<pre><code class="language-bash">EXPOSE 8080
</code></pre>
<p>该命令暴露的是<code>8080</code>端口，因为<code>Spring Boot</code>应用默认运行在<code>8080</code>上，如果修改了<code>application.yaml</code>或者<code>application.properties</code>请对应修改端口。</p>
<h3 id="525-添加命令">5.2.5 添加命令</h3>
<pre><code class="language-bash">ADD demo.jar demo.jar
</code></pre>
<p>将本地文件添加到容器中，<code>tar</code>类型文件会自动解压，这里是将<code>demo.jar</code>添加</p>
<h3 id="526-运行容器">5.2.6 运行容器</h3>
<pre><code class="language-bash">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;]
</code></pre>
<p>该命令用于配置容器的运行命令。</p>
<h1 id="6-制作镜像">6 制作镜像</h1>
<h2 id="61-基本操作">6.1 基本操作</h2>
<p>先说一下容器的基本操作：</p>
<ul>
<li><code>docker run</code>：创建一个新容器并运行</li>
<li><code>docker start/stop/restart</code>：启动/停止/重启容器</li>
<li><code>docker rm</code>：删除容器</li>
<li><code>docker create</code>：创建容器但不启动</li>
<li><code>docker ps</code>：列出容器</li>
</ul>
<p>镜像基本操作：</p>
<ul>
<li><code>docker build</code>：创建镜像</li>
<li><code>docker rmi</code>：删除镜像</li>
<li><code>docker images</code>：列出镜像</li>
</ul>
<p>这里简单说一下镜像和容器的区别：</p>
<ul>
<li>镜像相当于一个模板，可以从一个镜像创建出多个容器</li>
<li>用面向对象的思想比如，就是，镜像相当于一个类，而容器相当于一个类实例，也就是对象</li>
</ul>
<p>知道了一些基础命令后就可以来制作镜像了。</p>
<h2 id="62-创建镜像">6.2 创建镜像</h2>
<p>上传<code>Dockerfile</code>以及<code>JAR</code>包，新建一个目录把<code>JAR</code>以及<code>Dockerfile</code>放在同一个文件夹下，并进入该文件夹，接着创建镜像：</p>
<pre><code class="language-bash">build build -t demo .
</code></pre>
<p>创建完成后可以查看镜像：</p>
<pre><code class="language-bash">docker images
</code></pre>
<h2 id="63-运行">6.3 运行</h2>
<pre><code class="language-bash">docker run -d -p 8888:8080 demo
</code></pre>
<p>该命令表示从镜像<code>demo</code>创建一个容器并运行，将<code>8080</code>端口映射到<code>8888</code>端口上，主要防火墙需要开启<code>8888</code>端口，服务器记得配置安全组。</p>
<h2 id="64-测试">6.4 测试</h2>
<p>直接输入<code>ip:端口/test</code>即可访问：</p>
<figure data-type="image" tabindex="9"><img src="https://img-blog.csdnimg.cn/20200915003208987.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h1 id="7-源码">7 源码</h1>
<p><code>Java</code>版：</p>
<ul>
<li><a href="https://github.com/2293736867/SpringBootDemoJava/tree/main/Docker">Github</a></li>
<li><a href="https://gitee.com/u6b7b5fc3/SpringBootDemoJava/tree/main/Docker">码云</a></li>
<li><a href="https://codechina.csdn.net/qq_27525611/SpringBootDemoJava/-/tree/main/Docker">CODECHINA</a></li>
</ul>
<p><code>Kotlin</code>版：</p>
<ul>
<li><a href="https://github.com/2293736867/SpringBootDemoKotlin/tree/master/Docker">Github</a></li>
<li><a href="https://gitee.com/u6b7b5fc3/SpringBootDemoKotlin/tree/main/Docker">码云</a></li>
<li><a href="https://codechina.csdn.net/qq_27525611/SpringBootDemoKotlin/-/tree/main/Docker">CODECHINA</a></li>
</ul>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/mei-ri-fen-xiang-di-90-qi/">
              <h3 class="post-title">
                下一篇：每日分享 第90期
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
