
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>JFX11+IDEA跨平台打包发布的完美解决办法 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615371949211">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615371949211" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/jfx11idea-kua-ping-tai-da-bao-fa-bu-de-wan-mei-jie-jue-ban-fa.jpeg')">
            </div>
          
          <h2 class="post-title">JFX11+IDEA跨平台打包发布的完美解决办法</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-06-03</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/j0fdg3Cut/">
                    JFX
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/qkGQwVHv8/">
                    IDEA
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h1 id="1-概述">1 概述</h1>
<p>IDEA2020.1的文档中提到只有JFX8的工程才支持打成jar包，并且，如果直接使用Build Artifacts的话，会如下提示：<br>
<img src="https://img-blog.csdnimg.cn/2020053017384177.png" alt="在这里插入图片描述" loading="lazy"><br>
<a href="https://www.jetbrains.com/help/idea/packaging-javafx-applications.html">IDEA文档</a>有提到这个的解决办法，是使用一些<a href="https://openjfx.io/openjfx-docs/#install-javafx">第三方工具</a>。里面介绍了通过IDEA结合自身/Maven/Gradle打包发布JFX11以上版本的方法。但是，不足的地方有：</p>
<ul>
<li>直接创建JFX工程默认只有一个src目录，不像Maven工程还带有resources与test，给管理资源文件以及外部依赖造成了困难，getClass().getResource()会出现空指针问题，但是好处是只需具备JDK环境，打包出来的文件能带上jmods能跨平台直接运行</li>
<li>直接创建Maven项目虽然是管理依赖以及资源文件方便，但是无论是直接通过Maven打出的jar包还是通过JavaFX Maven Plugins打出来的jar包默认绑定了开发平台的JFX SDK，简单地说就是Linux开发的JFX程序不能直接跑在具有JDK环境的Win上，因为用的是Linux的JFX SDK而不是Win的JFX SDK</li>
</ul>
<p>因此，本文结合这两者的优点，参照Maven的目录管理，以JFX工程为基础，记录了从新建工程到发布跨平台JFX应用的过程。</p>
<h1 id="2-环境">2 环境</h1>
<ul>
<li>IDEA 2020.1</li>
<li>OpenJDK 11</li>
<li>OpenJFX 11 Linux SDK</li>
<li>OpenJFX 11 Linux/Windows/Mac OS X jmods</li>
</ul>
<p>JDK安装就不说了，JFX直接下载然后在工程中通过外部库引入即可，三种jmods解压出来即可，用于最后生成可执行文件时添加的模块。<br>
下载链接<a href="https://gluonhq.com/products/javafx/">戳这里</a>。</p>
<h1 id="3-新建jfx工程">3 新建JFX工程</h1>
<p><img src="https://img-blog.csdnimg.cn/20200530175758622.png" alt="在这里插入图片描述" loading="lazy"><br>
这里的项目名为TestJFX，对应修改即可。<br>
<img src="https://img-blog.csdnimg.cn/20200530175913541.png" alt="在这里插入图片描述" loading="lazy"></p>
<h1 id="4-添加jfx11-sdk">4 添加JFX11 SDK</h1>
<p><img src="https://img-blog.csdnimg.cn/20200530180127745.png" alt="在这里插入图片描述" loading="lazy"><br>
添加上一步下载的对应平台的JFX SDK。<br>
<img src="https://img-blog.csdnimg.cn/20200530180205495.png" alt="在这里插入图片描述" loading="lazy"></p>
<h1 id="5-添加module-infojava">5 添加module-info.java</h1>
<p>在src目录右键New-&gt;module-info.java，修改如下：</p>
<pre><code class="language-ruby">module TestJFX {
    requires javafx.fxml;
    requires javafx.controls;
    
    opens sample to javafx.fxml;
    exports sample;
}
</code></pre>
<p>其中TestJFX为新建项目时的项目名，这个创建module-info.java时就默认加上了，sample为默认包，对应修改。</p>
<h1 id="6-添加vm-options">6 添加VM Options</h1>
<p><img src="https://img-blog.csdnimg.cn/20200530181426399.png" alt="在这里插入图片描述" loading="lazy"><br>
<img src="https://img-blog.csdnimg.cn/20200531023450900.png" alt="在这里插入图片描述" loading="lazy"><br>
添加</p>
<pre><code class="language-bash">--module-path /usr/local/jfx/lib:out/production
</code></pre>
<p>其中</p>
<pre><code class="language-bash">/usr/local/jfx/lib
</code></pre>
<p>为下载的JFX JDK的lib目录，后面的out不需要更改，是默认的编译输出的目录。</p>
<h1 id="7-运行">7 运行</h1>
<p>这时候应该可以Shift+F10或者点击绿色小三角运行了：<br>
<img src="https://img-blog.csdnimg.cn/20200530181814745.png" alt="在这里插入图片描述" loading="lazy"><br>
当然内容是空的，因为什么也没有加。</p>
<h1 id="8-添加资源文件">8 添加资源文件</h1>
<p>默认的fxml是放在与Main类同一目录下的，getResource()也没有加路径直接写上文件名：<br>
<img src="https://img-blog.csdnimg.cn/20200530195546612.png" alt="在这里插入图片描述" loading="lazy"><br>
但是这是src文件夹，放个fxml还勉强可以接受，放张图片总不合适吧？所以，新建一个资源文件夹，把css，fxml什么的都放里面：<br>
<img src="https://img-blog.csdnimg.cn/20200530195911419.png" alt="在这里插入图片描述" loading="lazy"><br>
直接在IDEA中移动fxml文件，Main中的引用路径也自动更改，不得不说这个特性是真的好用，但遗憾的是，抛出了空指针异常。<br>
因此采取绝对路径来进行读取文件，通过URL+System.getProperty()指定绝对路径：</p>
<pre><code class="language-java">@Override
public void start(Stage primaryStage) throws Exception{
    String path = System.getProperty(&quot;user.dir&quot;);
    URL fxmlUrl = new URL(&quot;file:&quot;+path+&quot;/resources/fxml/sample.fxml&quot;);
    Parent root = FXMLLoader.load(fxmlUrl);
    primaryStage.setTitle(&quot;Hello World&quot;);
    Scene scene = new Scene(root);
    scene.getStylesheets().add(new URL(&quot;file:&quot;+path+&quot;/resources/css/1.css&quot;).toString());
    primaryStage.setScene(scene);
    primaryStage.show();
}
</code></pre>
<p>其中</p>
<pre><code class="language-java">System.getProperty(&quot;user.dir&quot;)
</code></pre>
<p>获取项目路径，注意URL前面要加上“file:”，css的获取也同理，只不过是需要转换为String。</p>
<h1 id="9-外部依赖">9 外部依赖</h1>
<p>由于没有了Maven管理依赖，所以外部依赖的管理会相对麻烦一点，基本上是以jar包的形式手动添加，这里以添加Gson为例，<a href="https://mvnrepository.com/artifact/com.google.code.gson/gson">戳这里</a>下载jar包，然后在项目目录下新建一个lib文件夹，把jar包放进去：<br>
<img src="https://img-blog.csdnimg.cn/20200531023924445.png" alt="在这里插入图片描述" loading="lazy"><br>
接着在项目结构中把整个lib文件夹添加到外部库：<br>
<img src="https://img-blog.csdnimg.cn/20200531022019954.png" alt="在这里插入图片描述" loading="lazy"><br>
然后VM Options中添加lib路径，在上面的VM Options后面加一个冒号和lib就行：<br>
<img src="https://img-blog.csdnimg.cn/20200531022600107.png" alt="在这里插入图片描述" loading="lazy"><br>
但是，此时可以IDEA还不能进行补全，最后需要修改module-info.java：<br>
<img src="https://img-blog.csdnimg.cn/20200531022743664.png" alt="在这里插入图片描述" loading="lazy"><br>
加一行requires，此时IDEA能够进行补全了，每个jar包都不同，对应修改即可。</p>
<h1 id="10-制作跨平台镜像">10 制作跨平台镜像</h1>
<p>运行没问题之后就可以制作运行时镜像发布了，终端进入项目根路径：</p>
<pre><code class="language-bash">jlink --module-path jmod/linux:out/production:lib --add-modules TestJFX --output linux
linux/bin/java -m TestJFX/sample.Main
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/20200531030506500.png" alt="在这里插入图片描述" loading="lazy"><br>
其中</p>
<pre><code class="language-bash">jmod/linux
</code></pre>
<p>为开发平台jmod的路径，可以是绝对路径，也可以是相对与项目根目录的相对路径，out/production与上面的VM Options保持一致。</p>
<pre><code class="language-bash">--add-modules
</code></pre>
<p>后面跟的是模块名，这是在生成module-info.java时指定的，为项目名。</p>
<pre><code class="language-bash">--output
</code></pre>
<p>为输出目录。<br>
后一条命令中-m指定模块名，后面跟包名+主类名。<br>
这样linux平台的镜像就制作好了，Mac与Win的同理，只需要把jmod换成对应平台的jmod即可，但是注意语法有一些差别，Mac的语法同Linux，只需要把jmod路径换一下，但是注意需要整个工程在对应的平台进行jlink：</p>
<pre><code class="language-bash">jlink --module-path xxxxx/{MAC_JMOD}:out/production:lib --add-modules TestJFX --output mac
mac/bin/java -m TestJFX/sample.Main
</code></pre>
<p>Win的语法有些区别，一样需要在Win下进行jlink：</p>
<pre><code class="language-bash">jlink --module-path &quot;xxxxx/{WIN_JMOD};out/production&quot; --add-modules TestJFX --output win
win\bin\java -m TestJFX/sample.Main
</code></pre>
<p>下面是Win下的截图：<br>
<img src="https://img-blog.csdnimg.cn/20200531025545467.PNG" alt="在这里插入图片描述" loading="lazy"></p>
<h1 id="11-demo">11 demo</h1>
<p><a href="https://github.com/2293736867/JFX11-IDEA-Test-Project">github</a></p>
<h1 id="12-参考">12 参考</h1>
<p><a href="https://openjfx.io/openjfx-docs/#maven">Getting Started with JavaFX</a></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/idea-tong-guo-maven-da-bao-javafx-gong-cheng-openjfx11/">
              <h3 class="post-title">
                下一篇：IDEA通过Maven打包JavaFX工程（OpenJFX11）
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
