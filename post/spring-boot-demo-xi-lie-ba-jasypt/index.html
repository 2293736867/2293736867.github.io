
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Spring Boot demo系列（九）：Jasypt | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615371949211">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615371949211" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/spring-boot-demo-xi-lie-ba-jasypt.jpeg')">
            </div>
          
          <h2 class="post-title">Spring Boot demo系列（九）：Jasypt</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-09-24</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/HhAuEu6wC/">
                    Demo
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/jLOEqgo2m/">
                    Spring Boot
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h1 id="2021224-更新">2021.2.24 更新</h1>
<h1 id="1-概述">1 概述</h1>
<p><code>Jasypt</code>是一个加密库，<code>Github</code>上有一个集成了<code>Jasypt</code>的<code>Spring Boot</code>库，叫<code>jasypt-spring-boot</code>，本文演示了如何使用该库对配置文件进行加密。</p>
<h1 id="2-依赖">2 依赖</h1>
<p>首先添加依赖：</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.github.ulisesbocchio&lt;/groupId&gt;
    &lt;artifactId&gt;jasypt-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.0.3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><code>Gradle</code>：</p>
<pre><code class="language-bash">implementation(&quot;com.github.ulisesbocchio:jasypt-spring-boot-starter:3.0.3&quot;)
</code></pre>
<h1 id="3-简单加密">3 简单加密</h1>
<p>简单加密就是直接把加密口令（注意不是加密密码）以明文形式写在配置文件中，步骤如下：</p>
<ul>
<li>配置文件配置加密口令</li>
<li>获取密文</li>
<li>替换明文</li>
</ul>
<h2 id="31-加密口令">3.1 加密口令</h2>
<p>在配置文件加上如下参数：</p>
<pre><code class="language-yaml">jasypt:
  encryptor:
    password: test
</code></pre>
<p>其中<code>test</code>就是加密的口令。</p>
<h2 id="32-获取密文">3.2 获取密文</h2>
<p>比如配置文件需要加密的值如下：</p>
<pre><code class="language-yaml">test: value
</code></pre>
<p>在测试类对<code>StringEncryptor</code>进行注入并使用其中的<code>encrypt</code>加密通过<code>@Value</code>获取的值：</p>
<pre><code class="language-java">@SpringBootTest
class DemoApplicationTests {
    @Autowired
    private StringEncryptor encryptor;

    @Value(&quot;${test}&quot;)
    private String value;

    @Test
    void contextLoads() {
        System.out.println(encryptor.encrypt(value));
    }
}
</code></pre>
<p>点击旁边的绿色小三角形即可运行，输出如下：</p>
<figure data-type="image" tabindex="1"><img src="https://img-blog.csdnimg.cn/20200924000606468.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>这个就是对应的密文。</p>
<h2 id="33-替换明文">3.3 替换明文</h2>
<p>把密文加上前缀<code>ENC(</code>与后缀<code>)</code>替换明文：</p>
<pre><code class="language-yaml">test: ENC(IlEvyvcULhZJrHLDtPun2ut433RvAdpaNJ9IZt9uNUk3hDSKQsdOXLEkWyiK6QR3)
</code></pre>
<p>这样就完成了对属性<code>test</code>进行加密。</p>
<h2 id="34-测试">3.4 测试</h2>
<p>直接通过<code>@Value</code>获取的值即为明文：</p>
<pre><code class="language-java">@SpringBootTest
class DemoApplicationTests {

    @Autowired
    private StringEncryptor encryptor;

    @Value(&quot;${test}&quot;)
    private String value;

    @Test
    void contextLoads() {
        System.out.println(encryptor.encrypt(value));
    }

    @Test
    void decrypt()
    {
        System.out.println(value);
    }
}
</code></pre>
<p>直接运行其中的<code>decrypt</code>即可输出明文。</p>
<h1 id="4-自定义加密">4 自定义加密</h1>
<h2 id="41-自定义加密类">4.1 自定义加密类</h2>
<p>默认采用的加密算法为<code>PBE</code>算法，如果觉得不能符合要求可以自定义加密类。</p>
<figure data-type="image" tabindex="2"><img src="https://img-blog.csdnimg.cn/20200924064738911.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>自定义加密类实现<code>StringEncrypto</code>接口即可，需要在配置文件写上<code>Bean</code>的名称：</p>
<pre><code class="language-java">@Component
public class Encryptor implements StringEncryptor{

    @Override
    public String encrypt(String s) {
        return s+&quot;111&quot;;
    }

    @Override
    public String decrypt(String s) {
        return s.substring(0,s.indexOf(&quot;111&quot;));
    }
}
</code></pre>
<p>这里的加密很简单，直接在明文后面加上<code>111</code>，解密的话去掉<code>111</code>。另外在配置文件上写上<code>Bean</code>的名称：</p>
<pre><code class="language-yaml">jasypt:
  encryptor:
#    password: test
    bean: encryptor
</code></pre>
<p>同时可以把口令注释掉，因为此时已经不需要使用口令进行加密了。</p>
<p>测试：</p>
<pre><code class="language-java">@SpringBootTest
class DemoApplicationTests {

    @Autowired
    private StringEncryptor encryptor;

    @Value(&quot;${test}&quot;)
    private String value;

    @Test
    void contextLoads() {
        System.out.println(encryptor.encrypt(value));
    }

    @Test
    void decrypt()
    {
        System.out.println(encryptor.decrypt(value));
    }

}
</code></pre>
<h2 id="42-非对称加密">4.2 非对称加密</h2>
<p>生成公钥与私钥借助了工具类库<code>Hutool</code>，依赖如下：</p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
    &lt;artifactId&gt;hutool-crypto&lt;/artifactId&gt;
    &lt;version&gt;5.4.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;
    &lt;artifactId&gt;bcprov-jdk15on&lt;/artifactId&gt;
    &lt;version&gt;1.66&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><code>Gradle</code>：</p>
<pre><code class="language-bash">implementation(&quot;cn.hutool:hutool-crypto:5.4.3&quot;)
implementation(&quot;org.bouncycastle:bcprov-jdk15on:1.66&quot;)
</code></pre>
<p>生成公钥私钥：</p>
<pre><code class="language-java">KeyPair pair = SecureUtil.generateKeyPair(&quot;RSA&quot;);
System.out.println(Base64.getEncoder().encodeToString(pair.getPublic().getEncoded()));
System.out.println(Base64.getEncoder().encodeToString(pair.getPrivate().getEncoded()));
</code></pre>
<p>生成后添加到<code>jasypt.encryptor.public-key-string</code>与<code>jasypt.encryptor.private-key-string</code>：</p>
<pre><code class="language-yaml">jasypt:
  encryptor:
#    password: test
#    bean: encryptor
    public-key-string: MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCZV5U0+Ck4AEpawUoiHOkG4ZNC6EeEvFZVCcyaIM0MiusGMM6ye9ZT6Ok756/vQsJbsYDGDtIDX82TsmYbZkN7QPuclABSL5SmaDYdJM/MeYKfMwrDb0lWARqF5ql9Rgol7Agq4ef8yQEbSmUDW/LQe+xXtCTer5MoJViUHV56MwIDAQAB
    private-key-string: MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAJlXlTT4KTgASlrBSiIc6Qbhk0LoR4S8VlUJzJogzQyK6wYwzrJ71lPo6Tvnr+9CwluxgMYO0gNfzZOyZhtmQ3tA+5yUAFIvlKZoNh0kz8x5gp8zCsNvSVYBGoXmqX1GCiXsCCrh5/zJARtKZQNb8tB77Fe0JN6vkyglWJQdXnozAgMBAAECgYA8syFCrwtt+ht00ne8ijIqQagP/6+z2PPZxL/DsUFJ+kGvmSlxGLlOTO/qgTuxG/2g22JsxFgY8tcHZMKrjO8f4TLKPsaFgX1OwNhJO4SoMlfUUAR9HSMv49vx5mOvh2QUrC5+4rIQI1Rm8zbKyAqCjHIKr8hA6bIKEHO2qXK05QJBANhAA+djwrr3orIIBTRp+H6/JChH76XtoQfcQyT+CrEu/4tHVkbO2cEqcdKDScswHyTPu5UaSU2HFW/0Lj8Kg40CQQC1h1YMysd51djCf/Ud7L2sSIduy3DUSLc6XRX1IWAqxO+8gkvknDW7QztNES9YqwYEkLNLAjp1v8Gq+o2JQKS/AkAENCpfQycz70BwaYuAW1cDT7/qMIvOE/J/bp63h2C51QoOsRJSSg8dnC+eQgMbOhJA6vDgkyQ9p5SZGowTmaa5AkEAneQAIZJC3KL3LX20ivm+pFpVijXjhpFU5avPjG4iQjEXQISoVEjWp3G747V91Aa1bkUZ3bUref13Cytw7h/O6wJBAJHNIHKKTAkmslguJU5hll1HqrzyI9lcB5XqcgvdsxijUkZ95FThk6hNQuNV0sO/itUijQsJAtNdDITKmdcPMWg=
</code></pre>
<p>然后就可以像加密得到密文并替换明文了。</p>
<h1 id="5-非明文口令">5 非明文口令</h1>
<p>对于<code>jasypt.encryptor.password</code>，可以使用非明文口令，这样口令的传递方式有三种：</p>
<ul>
<li>通过命令行参数传递</li>
<li>通过应用环境变量传递</li>
<li>通过系统环境变量传递</li>
</ul>
<h2 id="51-通过命令行参数传递">5.1 通过命令行参数传递</h2>
<p>首先先写上明文口令，得到密文：</p>
<pre><code class="language-yaml">jasypt:
  encryptor:
    password: test
test: value
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://img-blog.csdnimg.cn/20200924080510685.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>加上前后缀替换明文后，去掉加密口令：</p>
<pre><code class="language-yaml">#jasypt:
#  encryptor:
#    password: test

test: ENC(quCu1b+Z7SPHmgVsmbkeyNZmNe1LJw+SxjmwwLjNaWoH/ce3r6iHGvaMN5eQcu0P)
</code></pre>
<p>并在测试类的参数类加上</p>
<pre><code class="language-bash">--jasypt.encryptor.password=test
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://img-blog.csdnimg.cn/20200924080917909.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>由于这里是测试类命令行参数添加不了，但是在启动类是可以添加的：</p>
<figure data-type="image" tabindex="5"><img src="https://img-blog.csdnimg.cn/20200924081009860.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>这种方法就跳过演示了。</p>
<p>对于<code>Gradle</code>，测试的时候需要在<code>build.gradle</code>/<code>build.gradle.kts</code>添加参数：</p>
<pre><code class="language-java">tasks.withType&lt;Test&gt; {
    useJUnitPlatform()
    jvmArgs(&quot;-Djasypt.encryptor.password=test&quot;)
    // 不能是jvmArgs(&quot;--jasypt.encryptor.password=test&quot;)
}
</code></pre>
<h2 id="52-通过应用环境变量传递">5.2 通过应用环境变量传递</h2>
<p>和第一种方式差不多，第一种在<code>Program arguments</code>设置，而这种方法在<code>VM options</code>中设置：</p>
<pre><code class="language-bash">-Djasypt.encryptor.password=test
</code></pre>
<figure data-type="image" tabindex="6"><img src="https://img-blog.csdnimg.cn/20200924081304896.png" alt="在这里插入图片描述" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://img-blog.csdnimg.cn/20200924081352130.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h2 id="53-系统环境变量方式传递">5.3 系统环境变量方式传递</h2>
<p>通过系统环境变量方式传递<code>jasypt.encryptor.password</code>时，需要指定是哪一个环境变量：</p>
<pre><code class="language-yaml">jasypt:
  encryptor:
    password: ${ENCRYPT}
</code></pre>
<p>比如这里指定的是<code>ENCRYPT</code>环境变量，设置好环境变量后就可以直接加密解密了。</p>
<h1 id="6-部署注意事项">6 部署注意事项</h1>
<h2 id="61-打包">6.1 打包</h2>
<p>因为在配置文件中缺少了<code>jasypt.encryptor.password</code>，因此使用<code>Maven</code>打包时会出错：</p>
<figure data-type="image" tabindex="8"><img src="https://img-blog.csdnimg.cn/20200924152313685.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>在<code>Maven</code>打包配置中加上参数即可：</p>
<figure data-type="image" tabindex="9"><img src="https://img-blog.csdnimg.cn/20200924152518468.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>但是使用<code>Gradle</code>打包时不需要添加额外的参数。</p>
<h2 id="62-部署">6.2 部署</h2>
<p>现在一般通过<code>JAR</code>直接部署即可，也就是通过</p>
<pre><code class="language-bash">java -jar demo.jar
</code></pre>
<p>部署，这时候根据需要加上对应的参数即可，比如：</p>
<pre><code class="language-bash">java -jar demo.jar --jasypt.encryptor.password=test
java -Djasypt.encryptor.password=test -jar demo.jar
</code></pre>
<p>如果通过系统变量获取加密口令，请确保对应的环境变量存在。</p>
<p>另外，如果通过<code>Docker</code>部署，请在<code>ENTRYPOINT</code>加上对应参数，比如：</p>
<pre><code class="language-java">ENTRYPOINT [&quot;java&quot;,&quot;-Djasypt.encryptor.password=test&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;]
ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo.jar&quot;,,&quot;--jasypt.encryptor.password=test&quot;,]
</code></pre>
<p>通过系统环境变量获取请加上<code>ENV</code>：</p>
<pre><code class="language-bash">ENV ENCRYPT=&quot;test&quot;
</code></pre>
<h1 id="7-参考源码">7 参考源码</h1>
<p><code>Java</code>版：</p>
<ul>
<li><a href="https://github.com/2293736867/SpringBootDemoJava/tree/main/Jasypt">Github</a></li>
<li><a href="https://gitee.com/u6b7b5fc3/SpringBootDemoJava/tree/main/Jasypt">码云</a></li>
<li><a href="https://codechina.csdn.net/qq_27525611/SpringBootDemoJava/-/tree/main/Jasypt">CODECHINA</a></li>
</ul>
<p><code>Kotlin</code>版：</p>
<ul>
<li><a href="https://github.com/2293736867/SpringBootDemoKotlin/tree/main/Jasypt">Github</a></li>
<li><a href="https://gitee.com/u6b7b5fc3/SpringBootDemoKotlin/tree/main/Jasypt">码云</a></li>
<li><a href="https://codechina.csdn.net/qq_27525611/SpringBootDemoKotlin/-/tree/main/Jasypt">CODECHINA</a></li>
</ul>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/mei-ri-fen-xiang-di-100-qi/">
              <h3 class="post-title">
                下一篇：每日分享 第100期
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
