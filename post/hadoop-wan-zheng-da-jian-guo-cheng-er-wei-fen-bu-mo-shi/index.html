
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Hadoop完整搭建过程（二）：伪分布模式 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615371949211">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615371949211" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/hadoop-wan-zheng-da-jian-guo-cheng-er-wei-fen-bu-mo-shi.jpg')">
            </div>
          
          <h2 class="post-title">Hadoop完整搭建过程（二）：伪分布模式</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-08-22</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/6gn0AkH2Q/">
                    Hadoop
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p><ul class="markdownIt-TOC">
<li><a href="#1-%E4%BC%AA%E5%88%86%E5%B8%83%E6%A8%A1%E5%BC%8F">1 伪分布模式</a></li>
<li><a href="#2-hadoop%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2 <code>Hadoop</code>配置文件</a>
<ul>
<li><a href="#21-core-sitexml">2.1 <code>core-site.xml</code></a></li>
<li><a href="#22-hdfs-sitexml">2.2 <code>hdfs-site.xml</code></a></li>
<li><a href="#23-hadoop-envsh">2.3 <code>hadoop-env.sh</code></a></li>
</ul>
</li>
<li><a href="#3-%E6%9C%AC%E5%9C%B0%E6%97%A0%E5%AF%86%E7%A0%81ssh%E8%BF%9E%E6%8E%A5">3 本地无密码<code>ssh</code>连接</a></li>
<li><a href="#4-%E8%BF%90%E8%A1%8C">4 运行</a>
<ul>
<li><a href="#41-%E6%A0%BC%E5%BC%8F%E5%8C%96hdfs">4.1 格式化<code>HDFS</code></a></li>
<li><a href="#42-%E5%90%AF%E5%8A%A8namenode">4.2 启动<code>NameNode</code></a></li>
<li><a href="#43-%E6%B5%8B%E8%AF%95">4.3 测试</a></li>
</ul>
</li>
<li><a href="#5-%E4%BD%BF%E7%94%A8yarn%E9%85%8D%E7%BD%AE">5 使用<code>YARN</code>配置</a>
<ul>
<li><a href="#51-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">5.1 配置文件</a>
<ul>
<li><a href="#511-mapred-sitexml">5.1.1 <code>mapred-site.xml</code></a></li>
<li><a href="#512-yarn-sitexml">5.1.2 <code>yarn-site.xml</code></a></li>
</ul>
</li>
<li><a href="#52-%E8%BF%90%E8%A1%8C">5.2 运行</a></li>
</ul>
</li>
<li><a href="#6-%E5%8F%82%E8%80%83">6 参考</a></li>
</ul>
</p>
<h1 id="1-伪分布模式">1 伪分布模式</h1>
<p>伪分布模式是运行在单个节点以及多个Java进程上的模式。相比起本地模式，需要进行更多配置文件的设置以及<code>ssh</code>、<code>YARN</code>相关设置。</p>
<h1 id="2-hadoop配置文件">2 <code>Hadoop</code>配置文件</h1>
<p>修改<code>Hadoop</code>安装目录下的三个配置文件：</p>
<ul>
<li><code>etc/hadoop/core-site.xml</code></li>
<li><code>etc/hadoop/hdfs-site.xml</code></li>
<li><code>etc/hadoop/hadoop-env.sh</code></li>
</ul>
<h2 id="21-core-sitexml">2.1 <code>core-site.xml</code></h2>
<p>首先修改<code>core-site.xml</code>：</p>
<pre><code class="language-xml">&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;fs.defaultFS&lt;/name&gt;
        &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
    	&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
    	&lt;value&gt;/usr/local/hadoop/tmp&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<ul>
<li><code>fs.defaultFS</code>设置的是<code>HDFS</code>的地址，设置运行在本地的<code>9000</code>端口上</li>
<li><code>hadoop.tmp.dir</code>设置的是临时目录，如果没有设置的话默认在<code>/tmp/hadoop-${user.name}</code>中，系统重启后会导致数据丢失，因此修改这个临时目录的路径</li>
</ul>
<p>接着创建该临时目录：</p>
<pre><code class="language-bash">mkdir -p /usr/local/hadoop/tmp
</code></pre>
<h2 id="22-hdfs-sitexml">2.2 <code>hdfs-site.xml</code></h2>
<p>接着修改<code>hdfs-site.xml</code>：</p>
<pre><code class="language-xml">&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;dfs.replication&lt;/name&gt;
        &lt;value&gt;1&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<p><code>dfs.replication</code>设置的是<code>HDFS</code>存储的临时备份数量，因为伪分布模式中只有一个节点，所以设置为<code>1</code>。</p>
<h2 id="23-hadoop-envsh">2.3 <code>hadoop-env.sh</code></h2>
<p>修改该文件添加<code>JAVA_HOME</code>环境变量，就算<code>JAVA_HOME</code>在</p>
<ul>
<li><code>~/.bashrc</code></li>
<li><code>~/.bash_profile</code></li>
<li><code>/etc/profile</code></li>
</ul>
<p>等中设置了，运行时也是会提示找不到<code>JAVA_HOME</code>，因此需要手动在<code>hadoop-env.sh</code>中设置<code>JAVA_HOME</code>：</p>
<figure data-type="image" tabindex="1"><img src="https://img-blog.csdnimg.cn/20200818111428437.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h1 id="3-本地无密码ssh连接">3 本地无密码<code>ssh</code>连接</h1>
<p>下一步需要设置本地无密码<code>ssh</code>连接，首先先检查确保开启<code>sshd</code>服务：</p>
<pre><code class="language-bash">systemctl status sshd
</code></pre>
<p>开启后可以直接<code>localhost</code>连接：</p>
<pre><code class="language-bash">ssh localhost
</code></pre>
<p>输入自己的用户密码后就可以访问了，但是这里需要的是无密码连接，因此配置密钥认证连接的方式：</p>
<pre><code class="language-bash">ssh-keygen -t ed25519 -a 100 
cat ~/.ssh/id_25519.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 0600 ~/.ssh/authorized_keys
</code></pre>
<p>这里生成公私钥后把公钥添加到<code>authorized_keys</code>中，并且修改权限，需要注意<code>600</code>权限，只能本用户有写权限。</p>
<p>然后直接<code>ssh localhost</code>就可以连接本地主机了。</p>
<h1 id="4-运行">4 运行</h1>
<h2 id="41-格式化hdfs">4.1 格式化<code>HDFS</code></h2>
<p>这里以单一节点的模式运行，首先格式化<code>HDFS</code>：</p>
<pre><code class="language-bash"># HADOOP为Hadoop安装目录
HADOOP/bin/hdfs namenode -format
</code></pre>
<p>格式化是对<code>HDFS</code>中的<code>DataNode</code>进行分块，统计所有分块后的初始元数据，存储在<code>NameNode</code>中。</p>
<p>格式化成功后会在上面配置文件中设置的临时目录中生成<code>dfs</code>目录，如下所示：</p>
<figure data-type="image" tabindex="2"><img src="https://img-blog.csdnimg.cn/20200818020828662.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>里面只有一个目录：<code>dfs/name/current</code>，其中<code>tmp/dfs/name/current</code>的文件如下：</p>
<figure data-type="image" tabindex="3"><img src="https://img-blog.csdnimg.cn/2020081802122850.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>文件说明如下：</p>
<ul>
<li><code>fsimage</code>：<code>NameNode</code>元数据在内存满后，持久化保存到的文件</li>
<li><code>fsimage*.md5</code>：校验文件，用于校验<code>fsimage</code>的完整性</li>
<li><code>seen_txid</code>：存放<code>transactionID</code>文件，<code>format</code>之后为0,表示<code>NameNode</code>里面的<code>edits_*</code>文件的尾数</li>
<li><code>VERSION</code>：保存创建时间，<code>namespaceID</code>、<code>blockpoolID</code>、<code>storageType</code>、<code>cTime</code>、<code>clusterID</code>、<code>layoutVersion</code></li>
</ul>
<p>关于<code>VERSION</code>的说明：</p>
<ul>
<li><code>namespaceID</code>：<code>HDFS</code>唯一标识符，在<code>HDFS</code>首次格式化后生成</li>
<li><code>blockpoolID</code>：标识一个<code>block pool</code>，跨集群全局唯一</li>
<li><code>storageType</code>：存储什么进程的数据结构信息</li>
<li><code>cTime</code>：创建时间</li>
<li><code>clusterID</code>：系统生成或指定的集群<code>ID</code>，可以使用<code>-clusterid</code>指定</li>
<li><code>layoutVersion</code>：表示<code>HDFS</code>永久性数据结构版本的信息</li>
</ul>
<h2 id="42-启动namenode">4.2 启动<code>NameNode</code></h2>
<pre><code class="language-bash">HADOOP/sbin/start-dfs.sh
</code></pre>
<p>然后可以通过</p>
<pre><code class="language-bash">localhost:9870
</code></pre>
<p>访问<code>NameNode</code>：</p>
<figure data-type="image" tabindex="4"><img src="https://img-blog.csdnimg.cn/20200818111545267.png" alt="在这里插入图片描述" loading="lazy"></figure>
<h2 id="43-测试">4.3 测试</h2>
<p>生成输入目录，并使用配置文件作为输入：</p>
<pre><code class="language-bash">bin/hdfs dfs -mkdir /user
bin/hdfs dfs -mkdir /user/USER_NAME # USER_NAME为您的用户名
bin/hdfs dfs -mkdir input
bin/hdfs dfs -put etc/hadoop/*.xml input
</code></pre>
<p>测试：</p>
<pre><code class="language-bash">bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.0.jar grep input output 'dfs[a-z.]+'
</code></pre>
<p>获取输出：</p>
<pre><code class="language-bash">bin/hdfs dfs -get output output # 复制输出到output目录
cat output/*
</code></pre>
<figure data-type="image" tabindex="5"><img src="https://img-blog.csdnimg.cn/20200818112311395.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>停止：</p>
<pre><code class="language-bash">sbin/stop-hdfs.sh
</code></pre>
<h1 id="5-使用yarn配置">5 使用<code>YARN</code>配置</h1>
<p>除了可以将单个节点以伪分布模式启动，还可以通过<code>YARN</code>统一调度，只需要适当修改配置文件。</p>
<h2 id="51-配置文件">5.1 配置文件</h2>
<p>修改以下文件：</p>
<ul>
<li><code>HADOOP/etc/hadoop/mapred-site.xml</code></li>
<li><code>HADOOP/etc/hadoop/yarn-site.xml</code></li>
</ul>
<h3 id="511-mapred-sitexml">5.1.1 <code>mapred-site.xml</code></h3>
<pre><code class="language-xml">&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
        &lt;value&gt;yarn&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;mapreduce.application.classpath&lt;/name&gt;
        &lt;value&gt;$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<ul>
<li><code>mapreduce.framework.name</code>指定了<code>MapReduce</code>运行在<code>YARN</code>上</li>
<li><code>mapreduce.application.classpath</code>指定了类路径</li>
</ul>
<h3 id="512-yarn-sitexml">5.1.2 <code>yarn-site.xml</code></h3>
<pre><code class="language-xml">&lt;configuration&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;
        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;
    &lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
<ul>
<li><code>yarn.nodemanager.aux-services</code>：运行在<code>NodeManager</code>上运行的附属服务</li>
<li><code>yarn.nodemanager.env-whitelist</code>：环境变量通过从<code>NodeManagers</code>的容器继承的环境属性</li>
</ul>
<h2 id="52-运行">5.2 运行</h2>
<pre><code class="language-bash">sbin/start-yarn.sh
</code></pre>
<p>运行后就可以通过</p>
<pre><code class="language-bash">localhost:8088
</code></pre>
<p>访问：</p>
<figure data-type="image" tabindex="6"><img src="https://img-blog.csdnimg.cn/20200818115139159.png" alt="在这里插入图片描述" loading="lazy"></figure>
<p>停止：</p>
<pre><code class="language-bash">sbin/stop-yarn.sh
</code></pre>
<h1 id="6-参考">6 参考</h1>
<ul>
<li><a href="https://hadoop.apache.org/docs/r3.3.0/hadoop-project-dist/hadoop-common/SingleCluster.html#Pseudo-Distributed_Operation">Hadoop3.3.0官方文档</a></li>
<li><a href="https://blog.csdn.net/GitChat/article/details/77849331#t2">CSDN-GitChat·大数据 | 史上最详细的Hadoop环境搭建</a></li>
<li><a href="https://blog.csdn.net/levy_cui/article/details/60144621">CSDN-Hadoop Namenode元数据文件 Fsimage、editlog、seen_txid说明</a></li>
</ul>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/hadoop-wan-zheng-da-jian-guo-cheng-yi-ben-di-mo-shi/">
              <h3 class="post-title">
                下一篇：Hadoop完整搭建过程（一）：本地模式
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
