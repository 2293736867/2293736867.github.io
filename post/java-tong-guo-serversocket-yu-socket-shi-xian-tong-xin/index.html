
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Java通过ServerSocket与Socket实现通信 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615370942909">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615370942909" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/java-tong-guo-serversocket-yu-socket-shi-xian-tong-xin.jpg')">
            </div>
          
          <h2 class="post-title">Java通过ServerSocket与Socket实现通信</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-06-03</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/-AktfIpz8/">
                    Java
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p><ul class="markdownIt-TOC">
<li><a href="#1serversocket">1.ServerSocket</a>
<ul>
<li><a href="#1">(1)</a></li>
<li><a href="#2">(2)</a></li>
<li><a href="#3">(3)</a></li>
</ul>
</li>
<li><a href="#2socket">2.Socket</a>
<ul>
<li><a href="#1-2">(1)</a></li>
<li><a href="#2-2">(2)</a></li>
<li><a href="#3-2">(3)</a></li>
<li><a href="#4">(4)</a></li>
</ul>
</li>
<li><a href="#3%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF">3.服务器端</a></li>
<li><a href="#4%E5%AE%A2%E6%88%B7%E7%AB%AF">4.客户端</a></li>
<li><a href="#5%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C">5.运行结果</a></li>
<li><a href="#6socket%E8%AE%BE%E7%BD%AE%E8%B6%85%E6%97%B6">6.Socket设置超时</a></li>
</ul>
<br>
首先说一下ServerSocket与Socket.</p>
<h1 id="1serversocket">1.ServerSocket</h1>
<p>ServerSocket是用来监听客户端Socket连接的类,如果没有连接会一直处于等待状态.<br>
ServetSocket有三个构造方法:</p>
<h2 id="1">(1)</h2>
<pre><code class="language-java">ServerSocket(int port);
</code></pre>
<p>这个使用指定的端口去创建ServerSocket,IP地址使用默认的本地IP地址.</p>
<h2 id="2">(2)</h2>
<pre><code class="language-java">ServetSocket(int port,int backlog);
</code></pre>
<p>除了端口外,还有一个用来改变队列长度参数的backlog,指定当服务器繁忙时,可以与之保持连接请求的客户端数量,默认为50.</p>
<h2 id="3">(3)</h2>
<pre><code class="language-java">ServetSocket(int port,int backlog,InetAddress ip);
</code></pre>
<p>这个使用指定的端口,backlog,ip地址去创建ServerSocket.</p>
<p>(这里简单提一下InetAddress,InetAddress没有构造方法,只有两个静态方法获取InetAddress对象,分别是</p>
<pre><code class="language-java">getByName(String hostName);
getByAddress(byte[] address);
</code></pre>
<p>)</p>
<h1 id="2socket">2.Socket</h1>
<p>Socket一般用来连接到服务器,程序通过Socket发出网络请求或应答网络请求.<br>
Socket有三个构造方法:</p>
<h2 id="1-2">(1)</h2>
<pre><code class="language-java">Socket(InetAddress address,int port);
</code></pre>
<p>使用指定IP与指定端口构造Socket,对于本地地址,默认使用本地ip,对于本地端口则动态分配.</p>
<h2 id="2-2">(2)</h2>
<pre><code class="language-java">Socket(String address,int port);
</code></pre>
<p>与(1)一样,使用String表示远程ip.</p>
<h2 id="3-2">(3)</h2>
<pre><code class="language-java">Socket(InetAddress address,int port,InetAddress localAddr,int localPort);
</code></pre>
<p>创建指定了远程ip,远程端口,本地ip,本地端口的Socket.</p>
<h2 id="4">(4)</h2>
<pre><code class="language-java">Socket(String address,int port,InetAddress localAddr,int localPort)
</code></pre>
<p>与(2)类似,使用String表示远程ip,用InetAddress表示本地ip.</p>
<p>了解了ServerSocket与Socket后可以编写实现简单的通信了.</p>
<h1 id="3服务器端">3.服务器端</h1>
<pre><code class="language-java">import java.io.IOException;
import java.io.PrintStream;
import java.net.ServerSocket;
import java.net.Socket;

public class Server
{
    public static void main(String[] args) throws IOException
    {
        ServerSocket serverSocket = new ServerSocket(12345);//这个端口自己随意,建议1024以上未使用的端口.
        while(true)
        {
            Socket socket = serverSocket.accept();//一直等待来自客户端的请求.
            PrintStream printStream = new PrintStream(socket.getOutputStream());//创建输出流
            printStream.println(&quot;Server message.&quot;);
            printStream.close();
            socket.close();
        }
    }
}
</code></pre>
<p>说一下ServetSocket的accept()方法:</p>
<pre><code class="language-java">Socket accept();
</code></pre>
<p>没有参数,返回一个Socket,如果接收到客户端的一个Socket,则返回,否则一直处于等待状态,线程也被阻塞.</p>
<h1 id="4客户端">4.客户端</h1>
<pre><code class="language-java">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.InetAddress;
import java.net.Socket;

public class Client
{
    public static void main(String[] args) throws IOException
    {
        Socket socket = new Socket(&quot;127.0.0.1&quot;, 12345);
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        System.out.println(&quot;This message comes from server:&quot;+bufferedReader.readLine());
        bufferedReader.close();
        socket.close();
    }
}
</code></pre>
<pre><code class="language-java">Socket socket = new Socket(&quot;127.0.0.1&quot;, 12345);
</code></pre>
<p>表示创建一个本地地址,端口为12345的Socket,创建好了后服务器的.accept()方法就会接收到这个Socket,并创建输出流输出相应信息,然后客户端从Socket获取输入流进行读取,读取到了来自服务器的信息.</p>
<h1 id="5运行结果">5.运行结果</h1>
<p>(由于作者的漂亮终端不知道什么原因坏了....只能让用VScode的默认终端了....)<br>
先运行服务器端的代码:<br>
<img src="https://img-blog.csdnimg.cn/20191018234828415.png" alt="在这里插入图片描述" loading="lazy"><br>
服务器端这边因为accept()方法会一直阻塞直到客户端发送请求.<br>
<img src="https://img-blog.csdnimg.cn/20191018234834135.png" alt="在这里插入图片描述" loading="lazy"><br>
客户端这边一运行就收到了来自服务器端的信息.</p>
<h1 id="6socket设置超时">6.Socket设置超时</h1>
<p>可以为Socket设置超时设置,当Socket超过这个时间没有连接上时系统会认为连接失败.</p>
<pre><code class="language-java">Socket socket = new Socket(&quot;127.0.0.1&quot;,12345);
socket.setToTimeout(10000);//单位:ms,在这里是10s
</code></pre>
<p>但是未连接上之前无法创建Socket对象,并且Socket没有提供指定超时的构造方法,因此常见的做法是先创建一个无连接的Socket,再调用connect()方法连接.</p>
<pre><code class="language-java">Socket socket = new Socket();
socket.connect(new InetSocketAddress(&quot;127.0.0.1&quot;,12345),12345);
</code></pre>
<p>connect()方法其实有两个重载方法,分别是</p>
<pre><code class="language-java">void connect(SocketAddress endpoint);
void connect(SocketAddress endpoint,int timeout);
</code></pre>
<p>对于第一个connect()官方文档没有提及超时之类的,就是直接连接.<br>
对于第二个connect,timeout指定的超时时间,单位为ms,设置为0则为无限期等待.</p>
<p>参考链接<br>
1.<a href="https://blog.csdn.net/hutaoxiaodai/article/details/48030145">socket</a></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/java7-yu-java9-zhong-de-try-finally-guan-bi-zi-yuan/">
              <h3 class="post-title">
                下一篇：Java7与Java9中的try-finally关闭资源
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '477bf133e6f4f92e3d3d',
        clientSecret: 'c917fc4292d22d69e98b9521ac1e6fca627fe54c',
        repo: '2293736867.github.io',
        owner: '2293736867',
        admin: ['2293736867'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
