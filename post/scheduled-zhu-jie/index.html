
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>@Scheduled注解 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615370942909">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615370942909" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/scheduled-zhu-jie.jpg')">
            </div>
          
          <h2 class="post-title">@Scheduled注解</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-06-03</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/jM1IwIS2X/">
                    Spring
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p><ul class="markdownIt-TOC">
<li><a href="#1-%E6%A6%82%E8%BF%B0">1 概述</a></li>
<li><a href="#2-cron">2 cron</a>
<ul>
<li><a href="#21-cron%E9%80%9A%E9%85%8D%E7%AC%A6">2.1 cron通配符</a></li>
<li><a href="#22-cron%E7%A4%BA%E4%BE%8B">2.2 cron示例</a></li>
</ul>
</li>
<li><a href="#3-fixedrate">3 fixedRate</a>
<ul>
<li><a href="#31-fixedrate">3.1 fixedRate</a></li>
<li><a href="#32-fixedratestring">3.2 fixedRateString</a></li>
</ul>
</li>
<li><a href="#4-fixeddelay">4 fixedDelay</a>
<ul>
<li><a href="#41-fixeddelay">4.1 fixedDelay</a></li>
<li><a href="#42-fixeddelaystring">4.2 fixedDelayString</a></li>
</ul>
</li>
<li><a href="#5-initialdelay">5 initialDelay</a>
<ul>
<li><a href="#51-initialdelay">5.1 initialDelay</a></li>
<li><a href="#52-initialdelaystring">5.2 initialDelayString</a></li>
</ul>
</li>
</ul>
</p>
<h1 id="1-概述">1 概述</h1>
<p>@Scheduled注解是spring boot提供的用于定时任务控制的注解,主要用于控制任务在某个指定时间执行,或者每隔一段时间执行.注意需要配合@EnableScheduling使用,配置@Scheduled主要有三种配置执行时间的方式,cron,fixedRate,fixedDelay.</p>
<h1 id="2-cron">2 cron</h1>
<p>cron是@Scheduled的一个参数,是一个字符串,以5个空格隔开,只允许6个域(注意不是7个,7个直接会报错),分别表示秒,分,时,日,月,周.</p>
<table>
<thead>
<tr>
<th>单位</th>
<th>允许值</th>
<th>允许通配符</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>分</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>时</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>日</td>
<td>1-31</td>
<td>, - * / ? L W</td>
</tr>
<tr>
<td>月</td>
<td>1-12 或 JAN-DEC(大小写均可)</td>
<td>, - * / ?</td>
</tr>
<tr>
<td>周</td>
<td>1-7 或 SUN-SAT(大小写均可)</td>
<td>, - * / ? L #</td>
</tr>
</tbody>
</table>
<h2 id="21-cron通配符">2.1 cron通配符</h2>
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>所有值.在秒字段上表示每秒执行,在月字段上表示每月执行</td>
</tr>
<tr>
<td>?</td>
<td>不指定值,不需要关系当前指定的字段的值,比如每天都执行但不需要关心周几,就可以把周的字段设为?</td>
</tr>
<tr>
<td>-</td>
<td>区间,如秒的0-2,表示0秒,1秒,2秒都会触发</td>
</tr>
<tr>
<td>,</td>
<td>多个值,比如在0秒,20秒,25秒触发,可以把秒的字段设为0,20,25</td>
</tr>
<tr>
<td>/</td>
<td>递增触发,比如秒的字段上设0/3,从第0秒开始,每隔3秒触发</td>
</tr>
<tr>
<td>L</td>
<td>最后,只允许在日字段或周字段上,在日字段上使用L表示当月最后一天,在周字段上使用3L表示该月最后一个周四</td>
</tr>
<tr>
<td>W</td>
<td>只允许用在日字段上,表示距离最近的该日的工作日.工作日指的是周一至周五</td>
</tr>
<tr>
<td>#</td>
<td>只允许在周字段上,表示每月的第几个周几,如2#3,每月的第3个周二</td>
</tr>
</tbody>
</table>
<h2 id="22-cron示例">2.2 cron示例</h2>
<pre><code class="language-java">@Scheduled(cron = &quot;0 * * * 1 SAT&quot;) //每年的1月的所有周六的所有0秒时间执行
</code></pre>
<pre><code class="language-java">@Scheduled(cron = &quot;0 0 0 1 Jan ?&quot;) //每年的1月的1日的0时0分0秒执行
</code></pre>
<p>cron支持占位符,若在配置文件中有</p>
<pre><code class="language-java">cron = 2 2 2 2 2 ?
</code></pre>
<p>则</p>
<pre><code class="language-java">@Scheduled(cron = &quot;${cron}&quot;)
</code></pre>
<p>表示每年的二月二号的两时两分两秒执行.</p>
<h1 id="3-fixedrate">3 fixedRate</h1>
<h2 id="31-fixedrate">3.1 fixedRate</h2>
<p>fixedRate表示自上一次执行时间之后多长时间执行,以ms为单位.<br>
如</p>
<pre><code class="language-java">@Scheduled(fixedRate = 1000 * 5)
</code></pre>
<p>自上次执行之后5秒再执行.</p>
<h2 id="32-fixedratestring">3.2 fixedRateString</h2>
<p>有一个类似的参数叫fixedRateString,是字符串的形式,支持占位符.<br>
如</p>
<pre><code class="language-java">@Scheduled(fixedRateString = &quot;1000&quot;)
</code></pre>
<p>自上次执行1秒再执行.<br>
若在配置文件中有相应的属性,可以用占位符获取属性,如在application.properties中有</p>
<pre><code class="language-xml">interval=2000
</code></pre>
<p>可以使用</p>
<pre><code class="language-java">@Scheduled(fixedRateStirng=&quot;${interval}&quot;)
</code></pre>
<p>表示2秒间隔.</p>
<h1 id="4-fixeddelay">4 fixedDelay</h1>
<h2 id="41-fixeddelay">4.1 fixedDelay</h2>
<p>fixedDelay与fixedRate有点类似,不过fixedRate是上一次开始之后计时,fixedDelay是上一次结束之后计时,也就是说,fixedDelay表示上一次执行完毕之后多长时间执行,单位也是ms.</p>
<pre><code class="language-java">@Scheduled(fixedDelay = 1000 * 3600 * 12) //上一次执行完毕后半天后再次执行
</code></pre>
<h2 id="42-fixeddelaystring">4.2 fixedDelayString</h2>
<p>与fixedRateString类似,也是支持占位符</p>
<pre><code class="language-java">@Scheduled(fixedDelayString = &quot;${fixedDelay}&quot;)
</code></pre>
<h1 id="5-initialdelay">5 initialDelay</h1>
<h2 id="51-initialdelay">5.1 initialDelay</h2>
<p>initialDelay表示首次延迟多长时间后执行,单位ms,之后按照cron/fixedRate/fixedRateString/fixedDelay/fixedDelayString指定的规则执行,需要指定其中一个规则.</p>
<pre><code class="language-java">@Scheduled(initialDelay=1000,fixedRate=1000) //首次运行延迟1s
</code></pre>
<h2 id="52-initialdelaystring">5.2 initialDelayString</h2>
<p>与initialDelay类似,不过是字符串,支持占位符.</p>
<pre><code class="language-java">@Scheduled(initialDelayString = &quot;${initialDelay}&quot;,cron = &quot;0 0 0 14 4 ?&quot;) 
//按照配置文件initialDelay指定的时间首次延迟,并于每年4月14日0时0分0秒执行
</code></pre>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/mei-tian-ac-xi-lie-san-dian-hua-hao-ma-de-zi-mu-zu-he/">
              <h3 class="post-title">
                下一篇：每天AC系列(三):电话号码的字母组合
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '477bf133e6f4f92e3d3d',
        clientSecret: 'c917fc4292d22d69e98b9521ac1e6fca627fe54c',
        repo: '2293736867.github.io',
        owner: '2293736867',
        admin: ['2293736867'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
