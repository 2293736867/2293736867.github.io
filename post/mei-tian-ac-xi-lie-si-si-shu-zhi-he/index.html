
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>每天AC系列(四):四数之和 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615370942909">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615370942909" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/mei-tian-ac-xi-lie-si-si-shu-zhi-he.jpeg')">
            </div>
          
          <h2 class="post-title">每天AC系列(四):四数之和</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-06-03</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/DZ5E1trvJ/">
                    AC
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h1 id="1-题目">1 题目</h1>
<p><a href="https://leetcode-cn.com/problems/4sum/">Leetcode第18题</a>,给定一个数组与一个target,找出数组中的四个数之和为target的不重复的所有四个数.<br>
<img src="https://img-blog.csdnimg.cn/20200126100609278.png" alt="在这里插入图片描述" loading="lazy"></p>
<h1 id="2-暴力">2 暴力</h1>
<pre><code class="language-java">List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;();
if (nums.length == 4 &amp;&amp; nums[0] + nums[1] + nums[2] + nums[3] == target)
    result.add(Arrays.asList(nums[0], nums[1], nums[2],nums[3]));
else if (nums.length &gt; 4) 
{
    Arrays.sort(nums);
    Set&lt;List&lt;Integer&gt;&gt; resultSet = new HashSet&lt;&gt;();
    for(int i=0;i&lt;nums.length-3;++i)
    {
        for(int j=i+1;j&lt;nums.length-2;++j)
        {
            for(int k=j+1;k&lt;nums.length-1;++k)
            {
                for(int m=k+1;m&lt;nums.length;++m)
                {
                    if(nums[i]+nums[j]+nums[k]+nums[m] == target)
                        resultSet.add(Arrays.asList(nums[i],nums[j],nums[k],nums[m]));
                }
            }
        }
    }
    result.addAll(resultSet);
    Collections.sort(result,(t1,t2)-&gt;
    {
        if(t1.get(0) &gt; t2.get(0))
            return 1;
        if (t1.get(0) &lt; t2.get(0))
            return -1;
        if (t1.get(1) &gt; t2.get(1))
            return 1;
        if (t1.get(1) &lt; t2.get(1))
            return -1;
        if (t1.get(2) &gt; t2.get(2))
            return 1;
        if (t1.get(2) &lt; t2.get(2))
            return -1;
        if (t1.get(3) &gt; t2.get(3))
            return 1;
        if (t1.get(3) &lt; t2.get(3))
            return -1;
        return 0;
    });
}
return result;
</code></pre>
<p>判断长度,然后排序,直接上四个for,然后...<br>
<img src="https://img-blog.csdnimg.cn/20200126100444693.png" alt="在这里插入图片描述" loading="lazy"><br>
好! 惨败.</p>
<h1 id="3-优化">3 优化</h1>
<h2 id="31-去掉结果排序">3.1 去掉结果排序</h2>
<p>首先最后的排序是不必要的,也就是后面的</p>
<pre><code class="language-java">Collections.sort(result,(t1,t2)-&gt;
{
    if(t1.get(0) &gt; t2.get(0))
        return 1;
    if (t1.get(0) &lt; t2.get(0))
        return -1;
    if (t1.get(1) &gt; t2.get(1))
        return 1;
    if (t1.get(1) &lt; t2.get(1))
        return -1;
    if (t1.get(2) &gt; t2.get(2))
        return 1;
    if (t1.get(2) &lt; t2.get(2))
        return -1;
    if (t1.get(3) &gt; t2.get(3))
        return 1;
    if (t1.get(3) &lt; t2.get(3))
        return -1;
    return 0;
});
</code></pre>
<p>对结果进行排序不必要,虽然会在测试时与答案有差别,但是提交的话不需要排序.</p>
<h2 id="32-stream去重">3.2 stream去重</h2>
<p>之前的操作用的是HashSet进行去重,有一个符合的四元组就直接添加进集合中,现在采用了stream+distinct去重:</p>
<pre><code class="language-java">return result.stream().distinct().collect(Collectors.toList());
</code></pre>
<h2 id="33-双指针最大最小剪枝">3.3 双指针+最大最小剪枝</h2>
<p>可以利用类似三数之和的思想,固定一个数,双指针分别指向两端的两个数,这里的话,四个数,选择固定两个数,计算它们的和并把它们看作一个数,即可利用双指针.</p>
<pre><code class="language-java">for(int i=0;i&lt;nums.length-3;++i)
{
     for(int j=i+1;j&lt;nums.length-2;++j)
     {
         int m = nums[i] + nums[j];
         int left = j+1;
         int right = nums.length-1;
         while(left &lt; right)
         {
             int temp = m + nums[left] + nums[right];
             if(temp == target)
             {
                 result.add(Arrays.asList(nums[i], nums[j], nums[left], nums[right]));
                 --right;
                 ++left;
             }
             else if(temp &gt; target)
                 --right;
             else
                 ++left;
         }
     }
 }
</code></pre>
<p>m为固定的数,left与right就是双指针,根据&quot;三数&quot;之和判断与目标值的大小移动双指针.<br>
最小剪枝就是首先计算&quot;三数&quot;的最小值,若大于目标值就可以跳过,最大剪枝就是计算&quot;三数&quot;的最大值,若小于目标值则跳过,进入下一个循环:</p>
<pre><code class="language-java">int m = nums[i] + nums[j];
int left = j+1;
int right = nums.length-1;
if(m + nums[left] + nums[left+1] &gt; target)
    continue;
if (m + nums[right-1] + nums[right] &lt; target)
    continue;
</code></pre>
<h2 id="34-提交">3.4 提交</h2>
<p><img src="https://img-blog.csdnimg.cn/20200126104700810.png" alt="在这里插入图片描述" loading="lazy"><br>
呃...好了那么一点点吧.</p>
<h1 id="4-来来来再快一点">4 来来来再快一点</h1>
<h2 id="41-初始判断">4.1 初始判断</h2>
<p>首先,初始的判断可以再简单一点,如果数组为空或长度小于4,直接返回.</p>
<pre><code class="language-java">List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;();
if (nums == null &amp;&amp; nums.length &lt; 4)
	return result;
</code></pre>
<h2 id="42-一次不够就再剪几次">4.2 一次不够,就再剪几次</h2>
<p>上面的算法中,只是在两层for里面进行了一次最大最小剪枝,可以在没进入for之前剪一次:</p>
<pre><code class="language-java">Arrays.sort(nums);
int len = nums.length;
if(
	nums[0] + nums[1] + nums[2] + nums[3] &gt;  target 
	|| 
	nums[len-4] + nums[len-3] + nums[len-2] + nums[len-1] &lt; target
)
    return result;
for(int i=0;i&lt;len-3;++i)   
</code></pre>
<p>注意要先排序,然后直接判断整个数组的最大最小值并与target判断.<br>
然后在进入第一层for之后再剪一次:</p>
<pre><code class="language-java">for(int i=0;i&lt;len-3;++i)
{
	if(nums[i] + nums[i+1] + nums[i+2] + nums[i+3] &gt; target)
		break;
    if(nums[i] + nums[len-3] + nums[len-2] + nums[len-1] &lt; target)
		continue;
    for(int j=i+1;j&lt;len-2;++j)
}
</code></pre>
<p>因为数组是升序排序的,因此,&quot;最左边&quot;四个数肯定是最小值,若这个最小值大于target,可以直接break了,但是,最右边三个数与nums[i]相加不一定为最大值,因此判断之后若小于target只能continue.</p>
<h2 id="43-去重">4.3 去重</h2>
<h3 id="431-双指针去重">4.3.1 双指针去重</h3>
<p>首先,在双指针的循环中,若发现了有四个数符合条件,可以尝试多次移动指针:</p>
<pre><code class="language-java">result.add(Arrays.asList(nums[i], nums[j], nums[left++], nums[right--]));
while(left &lt; right &amp;&amp; nums[left] == nums[left-1])
    ++left;
while(left &lt; right &amp;&amp; nums[right] == nums[right+1]) 
    --right;
</code></pre>
<p>因为值一样的可以一次性移动指针,不需要再次进行和的判断.<br>
呃,可以尝试提交了.<br>
<img src="https://img-blog.csdnimg.cn/20200126112957623.png" alt="在这里插入图片描述" loading="lazy"><br>
咦,不对啊,做了这么多,没快多少啊...<br>
为啥呢...<br>
...</p>
<h3 id="432-外循环去重">4.3.2 外循环去重</h3>
<p>找了很久,发现是这里的原因:</p>
<pre><code class="language-java">return result.stream().distinct().collect(Collectors.toList());
</code></pre>
<p>这里去重的话,用是用的很舒服,一个stream(),一个distinct()就好了,问题是...还是很慢啊!!!<br>
所以呢,需要手动去重,出现重复的原因就是数组中有重复的数,比如:</p>
<pre><code class="language-java">[1,1,1,1,2,2,2,2],target=6
</code></pre>
<p>顺序判断时,会好几个</p>
<pre><code class="language-java">[1,1,2,2]
</code></pre>
<p>因此,对于重复的数,进行跳过处理,在第一层for中,对重复过的进行跳过:</p>
<pre><code class="language-java">for(int i=0;i&lt;len-2;++i)
	if(i&gt;0 &amp;&amp; nums[i] == nums[i-1]) continue;
</code></pre>
<p>其次,在第二层for中,也对重复过的进行跳过:</p>
<pre><code class="language-java">for(int j=i+1;j&lt;len-2;++j)
	if(j &gt; i+1 &amp;&amp; nums[j] == nums[j-1]) continue;
</code></pre>
<p>这样的话,例如对于上面的(不同的1用字母区分)</p>
<pre><code class="language-java">[1(a),1(b),1(c),1(d),2,2,2,2]
</code></pre>
<p>一开始是a处的1与b处的1,然后到了第二层循环,因为此时j=i+1,指向b处的1,因此不会跳过1,会进入双指针循环,第二次j指向c处的1,出现重复,j不断跳过直到j指向2.然后2结束后,到了i这层循环,因为1出现过,i不断跳过直到i指向2.</p>
<p>没错,说了这么多,去重不需要什么HashSet,不需要什么stream,只需两行:</p>
<pre><code class="language-java">if(i&gt;0 &amp;&amp; nums[i] == nums[i-1]) continue;
if(j&gt;i + 1 &amp;&amp; nums[j] == nums[j-1]) continue;
</code></pre>
<h2 id="44-提交">4.4 提交</h2>
<p><img src="https://img-blog.csdnimg.cn/20200126125547527.png" alt="在这里插入图片描述" loading="lazy"><br>
尽力了.</p>
<h1 id="5-源码">5 源码</h1>
<p><a href="https://github.com/2293736867/ACEveryDay/tree/master/Day4">github</a></p>
<p><a href="https://gitee.com/imykr/ACEveryDay/tree/master/Day4">码云</a></p>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/scheduled-zhu-jie/">
              <h3 class="post-title">
                下一篇：@Scheduled注解
              </h3>
            </a>
          </div>
          
      </div>

      
        
          <div id="gitalk-container"></div>
        

        
      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '477bf133e6f4f92e3d3d',
        clientSecret: 'c917fc4292d22d69e98b9521ac1e6fca627fe54c',
        repo: '2293736867.github.io',
        owner: '2293736867',
        admin: ['2293736867'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
