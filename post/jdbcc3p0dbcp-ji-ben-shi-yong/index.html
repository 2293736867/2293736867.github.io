
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>JDBC+C3P0+DBCP 基本使用 | 氷泠&#39;s blog</title>
<meta name="description" content="我配不上你，
纵然很努力。">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://2293736867.github.io/favicon.ico?v=1615371949211">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://2293736867.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://2293736867.github.io">
        <img class="avatar" src="https://2293736867.github.io/images/avatar.png?v=1615371949211" alt="" width="32px" height="32px">
      </a>
      <a href="https://2293736867.github.io">
        <h1 class="site-title">氷泠&#39;s blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://2293736867.github.io/post-images/jdbcc3p0dbcp-ji-ben-shi-yong.jpg')">
            </div>
          
          <h2 class="post-title">JDBC+C3P0+DBCP 基本使用</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-06-03</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://2293736867.github.io/tag/TrLCkYWTX/">
                    JDBC
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/94BG00D7hD/">
                    C3P0
                    
                      ，
                    
                  </a>
                
                  <a href="https://2293736867.github.io/tag/iZ_eZyYBHd/">
                    DBCP
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <p><ul class="markdownIt-TOC">
<li><a href="#1%E6%A6%82%E8%BF%B0">1.概述</a></li>
<li><a href="#2mysql%E7%9A%84%E5%A4%84%E7%90%86">2.mysql的处理</a>
<ul>
<li><a href="#1%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7">(1)新建用户</a></li>
<li><a href="#2%E5%BB%BA%E7%AB%8B%E6%95%B0%E6%8D%AE%E8%A1%A8">(2)建立数据表</a></li>
<li><a href="#3%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90">(3)用户权限</a></li>
</ul>
</li>
<li><a href="#2jdbc">2.JDBC</a>
<ul>
<li><a href="#1jar%E5%8C%85">(1)jar包</a></li>
<li><a href="#2%E8%BF%9E%E6%8E%A5">(2)连接</a></li>
<li><a href="#3statement">(3)Statement</a></li>
<li><a href="#4preparedstatement">(4)PreparedStatement</a></li>
<li><a href="#5%E4%BA%8B%E5%8A%A1">(5)事务</a></li>
</ul>
</li>
<li><a href="#3c3p0">3.C3P0</a>
<ul>
<li><a href="#1jar%E5%8C%85-2">(1)jar包</a></li>
<li><a href="#2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">(2)配置文件</a></li>
<li><a href="#3%E5%B7%A5%E5%85%B7%E7%B1%BB">(3)工具类</a></li>
</ul>
</li>
<li><a href="#4dbcp">4.DBCP</a>
<ul>
<li><a href="#1jar%E5%8C%85-3">(1)jar包</a></li>
<li><a href="#2%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-2">(2)配置文件</a></li>
<li><a href="#3%E5%B7%A5%E5%85%B7%E7%B1%BB-2">(3)工具类</a></li>
</ul>
</li>
<li><a href="#5%E6%BA%90%E7%A0%81">5.源码</a></li>
</ul>
</p>
<h1 id="1概述">1.概述</h1>
<p>这篇文章主要说了JDBC的基本使用,包括Statement,PreparedStatement,JDBC的连接,Mysql创建用户创建数据表,C3P0的连接与配置,DBCP的连接与配置.</p>
<h1 id="2mysql的处理">2.mysql的处理</h1>
<p>这里的JDBC使用Mysql作为DBMS,请先安装Mysql,未安装的<a href="https://www.mysql.com/">请点击这里下载</a>,<a href="https://www.cnblogs.com/xzlive/p/11023527.html">安装教程在这里</a>,作者使用的Mysql的8.0.17版本.</p>
<h2 id="1新建用户">(1)新建用户</h2>
<p>随便新建一个用户,比如这里作者新建的是aa,密码是aa123bb.</p>
<pre><code class="language-sql">create user 'aa'@'localhost' identified by 'aa123bb'
</code></pre>
<h2 id="2建立数据表">(2)建立数据表</h2>
<p>建立测试用的数据表与数据库.</p>
<pre><code class="language-sql">create database db;
use db;

create table db
(
    id int PRIMARY key,
    name char(20)
);
</code></pre>
<h2 id="3用户权限">(3)用户权限</h2>
<p>对刚才新建的用户授权:</p>
<pre><code class="language-sql">grant select,update,delete,insert on db.* to 'aa'@'localhost';
</code></pre>
<h1 id="2jdbc">2.JDBC</h1>
<h2 id="1jar包">(1)jar包</h2>
<p><a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.17/mysql-connector-java-8.0.17.jar">8.0.17版本在这里</a></p>
<p><a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">各个版本的在这里下载</a></p>
<h2 id="2连接">(2)连接</h2>
<p>首先注册驱动,驱动需要一个url,用户名和密码,用户名和密码是上一步创建好的,url包含ip地址,端口和数据库的名字.</p>
<pre><code class="language-java">private static final boolean mysqlVersionGreaterThen8 = true;
private static final String driver = &quot;com.mysql&quot; + (mysqlVersionGreaterThen8 ? &quot;.cj&quot; : &quot;&quot;) + &quot;.jdbc.Driver&quot;;
private static final String ip = &quot;127.0.0.1&quot;;
private static final String port = &quot;3306&quot;;
private static String databaseName = &quot;db&quot;;
private static String url;
private static String username = &quot;aa&quot;;
private static String password = &quot;k041400r&quot;;
private static Connection connection = null;

public static Connection getConnection() {
    try {
        url = &quot;jdbc:mysql://&quot; + ip + &quot;:&quot; + port + &quot;/&quot; + databaseName;
        Class.forName(driver);
        return connection = DriverManager.getConnection(url, username, password);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return null;
}
</code></pre>
<p>这里要注意以下旧版本的mysql的驱动叫com.mysql.jdbc.Driver,新版本的叫com.mysql.cj.jdbc.Driver.还有就是url的格式:</p>
<pre><code class="language-java">jdbc:mysql://ip:port/database
</code></pre>
<h2 id="3statement">(3)Statement</h2>
<p>获取数据库连接后,使用createStatement方法创建Statement</p>
<ul>
<li>对于select,使用Statement的executeQuery(sql),返回ResultSet</li>
<li>对于update,delete,insert,使用Statement的executeUpdate(sql)</li>
</ul>
<p>其中sql是要执行的sql语句,一个String.</p>
<pre><code class="language-java">public void useStatement() {
    try {
        useStatementInsert();
        useStatementSelect();
        useStatementUpdate();
        useStatementSelect();
        useStatementDelete();
    } catch (SQLException e) {
        e.printStackTrace();
    }
}

public void useStatementInsert() throws SQLException {
    String sql = &quot;insert into db(id,name) values(1,'23')&quot;;
    Statement statement = connection.createStatement();
    statement.executeUpdate(sql);
}

public void useStatementDelete() throws SQLException {
    String sql = &quot;delete from db&quot;;
    Statement statement = connection.createStatement();
    statement.executeUpdate(sql);
}

public void useStatementSelect() throws SQLException {
    String sql = &quot;select * from db&quot;;
    Statement statement = connection.createStatement();
    ResultSet resultSet = statement.executeQuery(sql);
    ResultSetMetaData resultSetMetaData = resultSet.getMetaData();
    int count = resultSetMetaData.getColumnCount();
    while (resultSet.next()) {
        for (int i = 1; i &lt;= count; ++i) {
            System.out.println(resultSet.getObject(i));
        }
    }
}

public void useStatementUpdate() throws SQLException {
    Statement statement = connection.createStatement();
    String sql = &quot;update db set id = 3,name = '555' where id = 1&quot;;
    statement.executeUpdate(sql);
}
</code></pre>
<p>这里对ResultSet使用的getMetaData,可以获取结果集的各种类型信息,包括字段的类型,个数,等等.</p>
<h2 id="4preparedstatement">(4)PreparedStatement</h2>
<p>PreparedStatement与Statement使用基本一样.调用的时候先使用Connection的prepareStatement(sql)创建,然后</p>
<ul>
<li>对于select,使用executeQuery(),返回一个ResultSet</li>
<li>对于update,delete,insert使用executeUpdate().</li>
</ul>
<pre><code class="language-java">public void usePrepareStatement() {
    try {
        usePrepareStatementInsert();
        usePrepareStatementSelect();
        usePrepareStatementUpdate();
        usePrepareStatementSelect();
        usePrepareStatementDelete();
    } catch (SQLException e) {
        e.printStackTrace();
    }
}

public void usePrepareStatementInsert() throws SQLException {
    String sql = &quot;insert into db(id,name) values(1,'23')&quot;;
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.executeUpdate();
}

public void usePrepareStatementDelete() throws SQLException {
    String sql = &quot;delete from db&quot;;
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.executeUpdate();
}

public void usePrepareStatementSelect() throws SQLException {
    String sql = &quot;select * from db&quot;;
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    ResultSet resultSet = preparedStatement.executeQuery();
    ResultSetMetaData resultSetMetaData = resultSet.getMetaData();
    int count = resultSetMetaData.getColumnCount();
    while (resultSet.next()) {
        for (int i = 1; i &lt;= count; ++i)
            System.out.println(resultSet.getObject(i));
    }
}

public void usePrepareStatementUpdate() throws SQLException {
    String sql = &quot;update db set id = 3,name = '555' where id = 1&quot;;
    PreparedStatement preparedStatement = connection.prepareStatement(sql);
    preparedStatement.executeUpdate();
}
</code></pre>
<h2 id="5事务">(5)事务</h2>
<p>Connection有一个setAutoCommit()方法,把它设置成false即可关闭自动提交,所有语句准备好后,一次性使用commit()提交即可.<br>
实现回滚可以配合SavePoint使用.</p>
<h1 id="3c3p0">3.C3P0</h1>
<h2 id="1jar包-2">(1)jar包</h2>
<p>两个:</p>
<ul>
<li>
<p><a href="https://repo1.maven.org/maven2/com/mchange/c3p0/0.9.5.4/c3p0-0.9.5.4.jar">c3p0</a></p>
</li>
<li>
<p><a href="https://repo1.maven.org/maven2/com/mchange/mchange-commons-java/0.2.19/mchange-commons-java-0.2.19.jar">mchange-commons</a></p>
</li>
</ul>
<h2 id="2配置文件">(2)配置文件</h2>
<p>src下创建一个叫c3p0.properties的文件:</p>
<pre><code class="language-cpp">c3p0.driverClass=com.mysql.cj.jdbc.Driver
c3p0.jdbcUrl=jdbc:mysql://127.0.0.1:3306/db
c3p0.user=aa
c3p0.password=aa123bb
</code></pre>
<p>这里按自己需要更改即可.</p>
<h2 id="3工具类">(3)工具类</h2>
<pre><code class="language-java">import com.mchange.v2.c3p0.ComboPooledDataSource;
import java.sql.Connection;

public class DbUtil
{
    private static ComboPooledDataSource C3P0dataSource = new ComboPooledDataSource(&quot;c3p0.properties&quot;);
    public static void releaseConnection(Connection connection)
    {
        try
        {
            if(connection != null)
                connection.close();
        }
        catch (Exception e)
        {
            e.printStackTrace();
        }
    }

    public static Connection getC3P0Connection()
    {
        try
        {
            return C3P0dataSource.getConnection();
        }
        catch (Exception e)
        {
            e.printStackTrace();
        }
        return null;
    }
}
</code></pre>
<h1 id="4dbcp">4.DBCP</h1>
<h2 id="1jar包-3">(1)jar包</h2>
<p>三个:</p>
<ul>
<li>
<p><a href="https://repo1.maven.org/maven2/org/apache/commons/commons-dbcp2/2.7.0/commons-dbcp2-2.7.0.jar">commons-dbcp</a></p>
</li>
<li>
<p><a href="https://repo1.maven.org/maven2/commons-logging/commons-logging/1.2/commons-logging-1.2.jar">commons-logging</a></p>
</li>
<li>
<p><a href="https://repo1.maven.org/maven2/org/apache/commons/commons-pool2/2.7.0/commons-pool2-2.7.0.jar">commons-pool</a></p>
</li>
</ul>
<h2 id="2配置文件-2">(2)配置文件</h2>
<p>src下新建dbcp.properties:</p>
<pre><code class="language-cpp">driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://127.0.0.1:3306/db
username=aa
password=k041400r
initialSize=10
maxActive=50
maxIdle=15
minIdle=10
maxWait=60000
connectionProperties=useUnicode=true;characterEncoding=utf8
defaultAutoCommit=true
</code></pre>
<p>分别是驱动,url,用户名,密码,初始化连接数,最大连接数,最大空闲连接数,最小空闲连接数,最大等待实际,连接属性(这里设置了编码),自动提交.</p>
<h2 id="3工具类-2">(3)工具类</h2>
<pre><code class="language-java">import org.apache.commons.dbcp2.BasicDataSourceFactory;

import java.io.InputStream;
import java.sql.Connection;
import java.util.Properties;
import javax.sql.DataSource;

public class DbUtil {
    private static DataSource DBCPdataSource;
    static {
        try {
            InputStream inputStream = DbUtil.class.getClassLoader().getResourceAsStream(&quot;dbcp.properties&quot;);
            Properties properties = new Properties();
            properties.load(inputStream);
            DBCPdataSource = BasicDataSourceFactory.createDataSource(properties);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public static Connection getDBCPConnection() {
        try {
            return DBCPdataSource.getConnection();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }

    public static void releaseConnection(Connection connection) {
        try {
            if (connection != null)
                connection.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>首先加载属性文件,再使用Properties的load方法将其加载到一个Properties对象中,最后交给BasicDataSourceFactory处理.</p>
<h1 id="5源码">5.源码</h1>
<p>包含了jar包,配置文件,sql文件与测试代码.</p>
<ul>
<li><a href="https://github.com/2293736867/JDBC-C3P0-DBCP">github</a></li>
<li><a href="https://gitee.com/imykr/JDBC-C3P0-DBCP">码云</a></li>
</ul>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://2293736867.github.io/post/cong-0-kai-shi-zi-zhi-ji-suan-qi/">
              <h3 class="post-title">
                下一篇：从0开始自制计算器!
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">我配不上你，
纵然很努力。</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://2293736867.github.io/atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
